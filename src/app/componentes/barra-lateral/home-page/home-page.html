<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mindora Dashboard</title>
  <link rel="stylesheet" href="home-page.css">
  <link rel="icon" type="image/x-icon" href="Assets/logoicon.ico">
</head>
<body>
  <aside class="sidebar">
    <img src="Assets/logoM.png" alt="logo" class="logo">

    <nav class="menu" aria-label="Menu principal">
      <button class="menu-item home active" aria-label="Início"></button>
      <button class="menu-item calendar" aria-label="Calendário"></button>
      <button class="menu-item notes" aria-label="Notas"></button>
      <button class="menu-item list" aria-label="Listas"></button>
      <button class="menu-item user" aria-label="Perfil"></button>
    </nav>
  </aside>

  <main class="content" role="main">
    <h2 class="welcome">Bom dia, Adriana.</h2>

    <div class="wrapper">

      <section class="card tarefas" aria-labelledby="tarefas-title">
        <h3 id="tarefas-title" class="title">Tarefas</h3>

        <div id="listaTarefas"></div>
      </section>

      <section class="card cadernos" aria-labelledby="cadernos-title">
        <h3 id="cadernos-title" class="title">Cadernos recentes</h3>

        <div class="notebooks" role="list" id="listaCadernos">

        </div>

        <button class="novo" aria-label="Criar caderno" id="btnNovoCaderno">Novo +</button>
      </section>

      <section class="card calendario" aria-labelledby="calendario-title">
        <h3 id="calendario-title" class="title">Calendário</h3>

        <div class="calendar-grid" role="list">

          <div class="day selected" role="listitem">
            <span class="weekday">Segunda</span>
            <strong class="number">19</strong>
            <div class="event"><span class="time">17:00</span> <span>Organizar Documentos</span></div>
          </div>

          <div class="day" role="listitem"><span class="weekday">Terça</span><strong class="number">20</strong></div>
          <div class="day" role="listitem"><span class="weekday">Quarta</span><strong class="number">21</strong></div>
          <div class="day" role="listitem"><span class="weekday">Quinta</span><strong class="number">22</strong></div>
          <div class="day" role="listitem"><span class="weekday">Sexta</span><strong class="number">23</strong></div>
          <div class="day" role="listitem"><span class="weekday">Sábado</span><strong class="number">24</strong></div>
          <div class="day" role="listitem"><span class="weekday">Domingo</span><strong class="number">25</strong></div>

        </div>
      </section>

    </div>
  </main>
  
  <script>
  document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const idUsuario = params.get("idUsuario");

  if (!idUsuario) {
    alert("Usuário não identificado");
  }

  const btnHome = document.querySelector(".menu-item.home");
  const btnCalendar = document.querySelector(".menu-item.calendar");
  const btnNotes = document.querySelector(".menu-item.notes");
  const btnList = document.querySelector(".menu-item.list");
  const btnUser = document.querySelector(".menu-item.user");

   btnHome.addEventListener("click", () => {
    window.location.href = `/src/app/componentes/barra-lateral/home-page/home-page.html?idUsuario=${idUsuario}`;
  });

  btnCalendar.addEventListener("click", () => {
    window.location.href = `/src/app/componentes/barra-lateral/calendario/calendario.html?idUsuario=${idUsuario}`;
  });

  btnNotes.addEventListener("click", () => {
    window.location.href = `/src/app/componentes/caderno/caderno.html?idUsuario=${idUsuario}`;
  });

  btnList.addEventListener("click", () => {
    window.location.href = `/src/app/componentes/barra-lateral/tarefas/tarefas.html?idUsuario=${idUsuario}`;
  });


  const modal = document.getElementById("modalCaderno");
  const btnNovo = document.getElementById("btnNovoCaderno");
  const btnCancelar = document.getElementById("btnCancelar");
  const categoriasSelect = document.getElementById("categoriasSelect");

   btnNovo.addEventListener("click", () => {
    modal.classList.remove("hidden");
    carregarCategorias(idUsuario);
  });

  btnCancelar.addEventListener("click", () => {
    modal.classList.add("hidden");
  });

  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.classList.add("hidden");
    }
  });

  carregarTarefasHome(idUsuario);
  carregarCadernos(idUsuario);


async function carregarCadernos(idUsuario) {
  try {
    const response = await fetch(
      `http://localhost:8080/cadernos/usuario/${idUsuario}`,
      { method: "GET" }
    );

    if (!response.ok) {
      throw new Error("Erro ao buscar cadernos");
    }

    const cadernos = await response.json();
    renderizarCadernos(cadernos, idUsuario);

  } catch (error) {
    console.error(error);
    alert("Erro ao carregar cadernos");
  }
}

 function renderizarCadernos(cadernos, idUsuario) {
  const container = document.getElementById("listaCadernos");
  container.innerHTML = "";

  if (!cadernos.length) {
    container.innerHTML = "<p>Nenhum caderno encontrado</p>";
    return;
  }

  cadernos.forEach(caderno => {
    const div = document.createElement("div");
    div.classList.add("notebook", "blue");
    div.setAttribute("role", "listitem");

    div.innerHTML = `
      <img class="notebook-cover" src="Assets/caderno_azul.png" alt="Capa caderno">
      <span>${caderno.titulo_caderno}</span>
      <small>${formatarData(caderno.dataCriacao)}</small>
    `;

    
    div.addEventListener("click", () => {
        window.location.href = `cadernos.html?id=${caderno.id}`;
    });

    container.appendChild(div);
  });
}

  function formatarData(data) {
  if (!data) return "—";
  return new Date(data).toLocaleDateString("pt-BR");
}


  async function carregarCategorias() {
  categoriasSelect.innerHTML = `<option>Carregando...</option>`;

  try {
    const params = new URLSearchParams(window.location.search);
    const idUsuario = params.get("idUsuario");

    const response = await fetch(
      `http://localhost:8080/categorias/${idUsuario}`
    );

    if (!response.ok) {
      throw new Error("Erro ao buscar categorias");
    }

    const categorias = await response.json();

    categoriasSelect.innerHTML = `<option value="">Selecione</option>`;

    categorias.forEach(cat => {
      const option = document.createElement("option");
      option.value = cat.id;
      option.textContent = cat.nomeCategoria;
      categoriasSelect.appendChild(option);
    });

  } catch (e) {
    console.error(e);
    categoriasSelect.innerHTML = `<option>Erro ao carregar</option>`;
  }
}

});
  </script>

  <script>
    async function carregarTarefasHome(idUsuario) {
  try {
    const response = await fetch(
      `http://localhost:8080/tarefas/usuario/${idUsuario}`
    );

    if (!response.ok) {
      throw new Error("Erro ao buscar tarefas");
    }

    const tarefas = await response.json();
    renderizarTarefasHome(tarefas);

  } catch (e) {
    console.error(e);
    alert("Erro ao carregar tarefas");
  }
}
  </script>

  <script>
function renderizarTarefasHome(tarefas) {
  const container = document.getElementById("listaTarefas");
  container.innerHTML = "";

  if (!tarefas.length) {
    container.innerHTML = "<p>Nenhuma tarefa encontrada</p>";
    return;
  }

  tarefas.forEach(tarefa => {
    const concluida = tarefa.statusTarefa === "REALIZADO";

    const task = document.createElement("div");
    task.classList.add("task");
    task.dataset.id = tarefa.id;

    task.innerHTML = `
      <div class="check ${concluida ? "done" : ""}">
        <input 
          type="checkbox" 
          ${concluida ? "checked" : ""} 
        />
      </div>

      <div class="task-info">
        <strong>${tarefa.tituloTarefa}</strong>
        <span class="date">${formatarData(tarefa.dataVencimento)}</span>
      </div>

      <span class="tag ${getClassePrioridade(tarefa.prioridade)}">
        ${getTextoPrioridade(tarefa.prioridade)}
      </span>
    `;

    const checkbox = task.querySelector("input");
    checkbox.addEventListener("change", () => {
      atualizarStatusTarefaHome(tarefa, checkbox.checked, task);
    });

    container.appendChild(task);
  });
}
</script>

<script>
async function atualizarStatusTarefaHome(tarefa, concluida, taskElement) {
  const body = {
    tituloTarefa: tarefa.tituloTarefa,
    descricao: tarefa.descricao,
    statusTarefa: concluida ? "REALIZADO" : "PENDENTE",
    prioridade: tarefa.prioridade,
    data_vencimento: tarefa.dataVencimento,
    usuario: {
      id: tarefa.usuario.id
    }
  };

  try {
    const response = await fetch(
      `http://localhost:8080/tarefas/${tarefa.id}`,
      {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      }
    );

    if (!response.ok) {
      throw new Error("Erro ao atualizar tarefa");
    }

    // Atualiza visualmente sem reload
    taskElement.querySelector(".check").classList.toggle("done", concluida);

  } catch (e) {
    alert("Erro ao atualizar tarefa");
    console.error(e);
  }
  }

  function formatarData(data) {
  if (!data) return "—";
  return new Date(data).toLocaleDateString("pt-BR");
  }

  function getTextoPrioridade(prioridade) {
  if (prioridade === 3) return "Importante";
  if (prioridade === 2) return "Desenvolvimento";
  return "Baixa";
  }

  function getClassePrioridade(prioridade) {
  if (prioridade === 3) return "high";
  if (prioridade === 2) return "medium";
  return "low";
  }
</script>

  <div class="modal hidden" id="modalCaderno">
  <div class="modal-content">

    <h3>Novo Caderno</h3>

    <label for="tituloCaderno">Título</label>
    <input
      type="text"
      id="tituloCaderno"
      placeholder="Nome do caderno"
    />

    <label for="categoriasSelect">Categoria</label>
    <select id="categoriasSelect">
      <option value="">Carregando categorias...</option>
    </select>

    <div class="modal-actions">
      <button id="btnCancelar">Cancelar</button>
      <button id="btnCriarCaderno">Criar</button>
    </div>

  </div>
  </div>
</body>
</html>

